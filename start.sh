#!/bin/bash
# <============================================>

#   ███████╗████████╗ █████╗ ██████╗ ████████╗
#   ██╔════╝╚══██╔══╝██╔══██╗██╔══██╗╚══██╔══╝
#   ███████╗   ██║   ███████║██████╔╝   ██║
#   ╚════██║   ██║   ██╔══██║██╔══██╗   ██║
#   ███████║   ██║   ██║  ██║██║  ██║   ██║
#   ╚══════╝   ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝   ╚═╝

# <============================================>
#       Start the ETLs and other processes
# <============================================>
#  Stop script on errors
# <============================================>
set -euo pipefail
# <============================================>
#  Pull Large Files (PDI)
# <============================================>
git lfs pull
# <============================================>
#  Extract PDI if not extracted yet
# <============================================>
[ ! -d './.pdi' ] && 7z x './pdi/Pentaho_DI.7z' -o'./.pdi'
# <============================================>
#  Run ETLs with PDI
# <============================================>
./.pdi/kitchen.sh /file:'./kettle/data.kjb' /level:Basic /norep
# <============================================>
#  Run schema process
# <============================================>
echo "Generating schemas..."
./schema/code/start.sh
# <============================================>
#  Run visualization process
# <============================================>
echo "Generating visualizations..."
./visuals/code/start.sh
# <============================================>
